<div class="page-container">

  <div class="page-header">
    <div class="header-content">
      <div class="title-group">
        <h1>{{ stationStore.station()?.name || 'My Station' }}</h1>
        <p>Station Dashboard & Inventory Management</p>
      </div>
      <div class="status-badge" [class.active]="stationStore.station()?.status === 'active'">
        {{ stationStore.station()?.status || 'Unknown' }}
      </div>
    </div>
  </div>

  <div class="dashboard-grid">

    <!-- Row 1: Tanks & Inventory (Visual Focus) -->
    <div class="card-base inventory-section">
      <div class="card-header">
        <h3>Fuel Inventory Levels</h3>
        <p class="subtitle">Real-time tank monitoring</p>
      </div>
      <div class="card-body tanks-grid">
        @for (tank of tankLevels(); track tank.product) {
        <div class="tank-card">
          <div class="tank-visual">
            <div class="liquid" [style.height.%]="tank.percentage" [class.petrol]="tank.product === 'Petrol'"
              [class.diesel]="tank.product === 'Diesel'"></div>
            <div class="percentage-label">{{ tank.percentage }}%</div>
          </div>
          <div class="tank-info">
            <h4>{{ tank.product }} Tank</h4>
            <div class="metric">
              <span class="value">{{ formatNumber(tank.currentVolume) }}</span>
              <span class="unit">Liters</span>
            </div>
            <div class="capacity">
              Capacity: {{ formatNumber(tank.capacity) }}L
            </div>
          </div>
        </div>
        }
      </div>
    </div>

    <!-- Row 2: Pump Management -->
    <div class="card-base pumps-section">
      <div class="card-header">
        <div class="header-with-stats">
          <div>
            <h3>Pump Management</h3>
            <p class="subtitle">Overview of {{ pumpStatuses().length }} pumps</p>
          </div>
          <div class="stats-pills">
            <span class="pill active-pill">{{ activePumpsCount() }} Active</span>
            <span class="pill maintenance-pill">{{ pumpsUnderMaintenanceCount() }} Maint.</span>
          </div>
        </div>
      </div>
      <div class="card-body pumps-grid">
        @for (pump of pumpStatuses(); track pump.id) {
        <div class="pump-card" [class]="pump.status.toLowerCase()">
          <div class="pump-header">
            <span class="pump-number">#{{ pump.number }}</span>
            <span class="pump-status">{{ pump.status }}</span>
          </div>
          <div class="pump-product">{{ pump.product }}</div>

          <mat-divider></mat-divider>

          <div class="pump-body">
            @if (pump.status === 'Active' && pump.currentSession) {
            <div class="session-info">
              <div class="vehicle">{{ pump.currentSession.vehicle }}</div>
              <div class="dispensing">
                <span class="liters">{{ pump.currentSession.liters }}L</span> •
                <span class="amount">₦{{ formatNumber(pump.currentSession.amount) }}</span>
              </div>
              <mat-progress-bar mode="indeterminate" class="pump-progress"></mat-progress-bar>
            </div>
            } @else {
            <div class="idle-state">
              <mat-icon>{{ pump.status === 'Maintenance' ? 'build' : 'local_gas_station' }}</mat-icon>
              <span>{{ pump.status === 'Idle' ? 'Ready to dispense' : 'Under Service' }}</span>
            </div>
            }
          </div>
        </div>
        }
      </div>
    </div>

    <!-- Row 3: Recent Activity (Table) -->
    <div class="card-base activity-section">
      <div class="card-header">
        <h3>Recent Transactions</h3>
      </div>
      <div class="card-body no-padding">

        <div class="table-responsive">
          <table class="custom-table">
            <thead>
              <tr>
                <th>Time</th>
                <th>Transaction ID</th>
                <th>Product</th>
                <th>Liters</th>
                <th>Amount</th>
                <th>Payment</th>
                <th>Status</th>
              </tr>
            </thead>
            <tbody>
              @for (tx of recentTransactions(); track tx.id) {
              <tr>
                <td>{{ tx.time }}</td>
                <td class="mono">{{ tx.id }}</td>
                <td>
                  <span class="product-badge" [class]="tx.product.toLowerCase()">{{ tx.product }}</span>
                </td>
                <td class="numeric">{{ tx.liters }} L</td>
                <td class="numeric bold">₦{{ formatNumber(tx.amount) }}</td>
                <td>{{ tx.paymentMethod }}</td>
                <td>
                  <span class="status-chip" [class.active]="tx.status === 'Completed'"
                    [class.pending]="tx.status === 'Pending'">
                    {{ tx.status }}
                  </span>
                </td>
              </tr>
              }
            </tbody>
          </table>
        </div>

      </div>
    </div>

  </div>
</div>