<div class="page-container">
  <!-- Header Section -->
  <div class="page-header">
    <div class="header-content">
      <div class="title-group">
        <h1>Sales Performance Dashboard</h1>
        <p>Comprehensive overview of sales metrics and station rankings</p>
      </div>

      <div class="action-group">
        <div class="filter-wrapper">
          <mat-form-field appearance="outline" class="dense-form-field">
            <mat-label>Filter Station</mat-label>
            <mat-select [formControl]="filterForm.controls.stationId">
              <mat-option value="all">All Stations</mat-option>
              @for (station of allStations(); track station) {
              <mat-option [value]="station.stationId">{{ station.stationName }}</mat-option>
              }
            </mat-select>
            <mat-icon matPrefix>filter_alt</mat-icon>
          </mat-form-field>
        </div>

        <button mat-flat-button color="primary" (click)="exportData()">
          <mat-icon>cloud_download</mat-icon> Export Data
        </button>
      </div>
    </div>
  </div>

  <div class="dashboard-grid">

    <!-- Top Row: Revenue Comparison Chart & Total Revenue Card -->
    <div class="grid-row-uneven">

      <!-- Chart Card -->
      <div class="card-base chart-card">
        <div class="card-header">
          <div class="title-with-icon">
            <h3>Product Revenue Comparison</h3>
          </div>
          <p class="subtitle">Total revenue generated by Petrol vs. Diesel</p>
        </div>
        <div class="card-body">
          <canvas baseChart [data]="productRevenueChartData()" [options]="barChartOptions" [type]="barChartType">
          </canvas>
        </div>
      </div>

      <!-- Revenue Summary Card -->
      <div class="card-base revenue-summary-card">
        <div class="card-header">
          <h3>Total Revenue</h3>
        </div>
        <div class="card-body">
          <div class="icon-wrapper">
            <mat-icon>trending_up</mat-icon>
          </div>
          <div class="revenue-value">
            ₦{{ totalRevenue() | number:'1.0-0' }}
          </div>
          <p class="description">Cumulative revenue for selected period/stations</p>
        </div>
      </div>

    </div>

    <!-- Trend Chart Row -->
    <div class="card-base chart-card">
      <div class="card-header">
        <div class="title-with-icon">
          <h3>Daily Sales Trend</h3>
        </div>
        <p class="subtitle">Revenue trend over the last few days</p>
      </div>
      <div class="card-body">
        <canvas baseChart [data]="salesTrendChartData()" [options]="lineChartOptions" [type]="lineChartType">
        </canvas>
      </div>
    </div>

    <!-- Ranking Grid Row -->
    <div class="grid-row-halves">

      <!-- Top Performers -->
      <div class="card-base ranking-card top-performers">
        <div class="card-header">
          <h3>Top Performing Stations</h3>
        </div>
        <div class="card-body no-padding">
          <table mat-table [dataSource]="topStations()" class="ranking-table">
            <ng-container matColumnDef="rank">
              <th mat-header-cell *matHeaderCellDef> Rank </th>
              <td mat-cell *matCellDef="let element; let i = index" class="rank-cell">
                <span class="rank-badge">{{ i + 1 }}</span>
              </td>
            </ng-container>

            <ng-container matColumnDef="stationName">
              <th mat-header-cell *matHeaderCellDef> Station </th>
              <td mat-cell *matCellDef="let element">
                <span class="station-name">{{ element.stationName }}</span>
              </td>
            </ng-container>

            <ng-container matColumnDef="totalRevenueNGN">
              <th mat-header-cell *matHeaderCellDef class="text-right"> Revenue </th>
              <td mat-cell *matCellDef="let element" class="revenue-cell">
                ₦{{ element.totalRevenueNGN | number:'1.0-0' }}
              </td>
            </ng-container>

            <tr mat-header-row *matHeaderRowDef="['rank', 'stationName', 'totalRevenueNGN']"></tr>
            <tr mat-row *matRowDef="let row; columns: ['rank', 'stationName', 'totalRevenueNGN'];"></tr>
          </table>
        </div>
      </div>

      <!-- Least Performers -->
      <div class="card-base ranking-card least-performers">
        <div class="card-header">
          <h3>Least Performing Stations</h3>
        </div>
        <div class="card-body no-padding">
          <table mat-table [dataSource]="leastStations()" class="ranking-table">
            <ng-container matColumnDef="rank">
              <th mat-header-cell *matHeaderCellDef> Rank </th>
              <td mat-cell *matCellDef="let element; let i = index" class="rank-cell">
                <span class="rank-badge">{{ i + 1 }}</span>
              </td>
            </ng-container>

            <ng-container matColumnDef="stationName">
              <th mat-header-cell *matHeaderCellDef> Station </th>
              <td mat-cell *matCellDef="let element">
                <span class="station-name">{{ element.stationName }}</span>
              </td>
            </ng-container>

            <ng-container matColumnDef="totalRevenueNGN">
              <th mat-header-cell *matHeaderCellDef class="text-right"> Revenue </th>
              <td mat-cell *matCellDef="let element" class="revenue-cell">
                ₦{{ element.totalRevenueNGN | number:'1.0-0' }}
              </td>
            </ng-container>

            <tr mat-header-row *matHeaderRowDef="['rank', 'stationName', 'totalRevenueNGN']"></tr>
            <tr mat-row *matRowDef="let row; columns: ['rank', 'stationName', 'totalRevenueNGN'];"></tr>
          </table>
        </div>
      </div>

    </div>

  </div>
</div>