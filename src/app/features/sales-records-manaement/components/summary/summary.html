<div class="dashboard-container">
  <header fxLayout="row" fxLayoutAlign="space-between center" fxLayout.lt-md="column" fxLayoutAlign.lt-md="start start"
    class="dashboard-header">
    <h1 class="header-title">{{ 'Sales Performance Dashboard' }}</h1>
    <div fxLayout="row" fxLayoutAlign="end center" fxLayout.lt-md="column" fxLayoutAlign.lt-md="stretch start"
      fxLayoutGap="16px" class="header-actions">

      <mat-form-field appearance="outline" class="station-filter" fxFlex.lt-md="100%">
        <mat-label>Filter Station</mat-label>
        <mat-select [formControl]="filterForm.controls.stationId">
          <mat-option value="all">All Stations</mat-option>
          @for (station of allStations(); track station) {
          <mat-option [value]="station.stationId">{{ station.stationName }}</mat-option>
          }
        </mat-select>
      </mat-form-field>

      <button mat-flat-button color="primary" (click)="exportData()" fxFlex.lt-md="100%">
        <mat-icon class="icon-spacing">cloud_download</mat-icon> Export Data
      </button>
    </div>
  </header>

  <div fxLayout="row" fxLayout.lt-md="column" fxLayoutGap="32px" class="main-grid">

    <mat-card class="chart-card chart-bar-comparison card-style" fxFlex="70" fxFlex.lt-md="100">
      <mat-card-header class="card-header-style">
        <mat-card-title class="card-title">Product Revenue Comparison (NGN)</mat-card-title>
        <mat-card-subtitle class="card-subtitle">Total revenue generated by Petrol (Indigo) vs. Diesel
          (Rose).</mat-card-subtitle>
      </mat-card-header>
      <mat-card-content class="card-chart-content">
        <canvas baseChart [data]="productRevenueChartData()" [options]="barChartOptions" [type]="barChartType">
        </canvas>
      </mat-card-content>
    </mat-card>

    <mat-card class="revenue-card card-style" fxFlex="30" fxFlex.lt-md="100">
      <mat-card-title class="revenue-title">Total Revenue Filtered</mat-card-title>
      <div class="revenue-value-group">
        <mat-icon class="revenue-icon">trending_up</mat-icon>
        <p class="revenue-value">₦{{ totalRevenue() | number:'1.0-0' }}</p>
      </div>
      <p class="revenue-subtitle">Cumulative revenue for selected period/stations. Use the filter above to adjust the
        scope.</p>
    </mat-card>

  </div>

  <mat-card class="chart-card chart-trend card-style trend-card">
    <mat-card-header class="card-header-style">
      <mat-card-title class="card-title">Daily Sales Trend</mat-card-title>
      <mat-card-subtitle class="card-subtitle">Revenue trend over the last few days.</mat-card-subtitle>
    </mat-card-header>
    <mat-card-content class="card-chart-content">
      <canvas baseChart [data]="salesTrendChartData()" [options]="lineChartOptions" [type]="lineChartType">
      </canvas>
    </mat-card-content>
  </mat-card>

  <div fxLayout="row" fxLayout.lt-md="column" fxLayoutGap="32px" class="ranking-grid">

    <mat-card class="ranking-card top-performers card-style" fxFlex="50" fxFlex.lt-md="100">
      <mat-card-header class="card-header-ranking top-header">
        <mat-card-title class="ranking-title">TOP PERFORMING STATIONS</mat-card-title>
      </mat-card-header>
      <mat-card-content class="card-content-ranking">
        <table mat-table [dataSource]="topStations()" class="ranking-table">
          <ng-container matColumnDef="rank">
            <th mat-header-cell *matHeaderCellDef> Rank </th>
            <td mat-cell *matCellDef="let element; let i = index" class="rank-cell">
              <span class="rank-badge rank-badge-top">{{ i + 1 }}</span>
            </td>
          </ng-container>

          <ng-container matColumnDef="stationName">
            <th mat-header-cell *matHeaderCellDef> Station </th>
            <td mat-cell *matCellDef="let element"> {{ element.stationName }} </td>
          </ng-container>

          <ng-container matColumnDef="totalRevenueNGN">
            <th mat-header-cell *matHeaderCellDef class="text-right"> Revenue (₦) </th>
            <td mat-cell *matCellDef="let element" class="revenue-cell revenue-cell-top"> ₦{{ element.totalRevenueNGN |
              number:'1.0-0' }} </td>
          </ng-container>

          <tr mat-header-row *matHeaderRowDef="['rank', 'stationName', 'totalRevenueNGN']" class="ranking-header-row">
          </tr>
          <tr mat-row *matRowDef="let row; columns: ['rank', 'stationName', 'totalRevenueNGN'];"
            class="ranking-row ranking-row-top"></tr>
        </table>
      </mat-card-content>
    </mat-card>

    <mat-card class="ranking-card least-performers card-style" fxFlex="50" fxFlex.lt-md="100">
      <mat-card-header class="card-header-ranking least-header">
        <mat-card-title class="ranking-title">LEAST PERFORMING STATIONS</mat-card-title>
      </mat-card-header>
      <mat-card-content class="card-content-ranking">
        <table mat-table [dataSource]="leastStations()" class="ranking-table">
          <ng-container matColumnDef="rank">
            <th mat-header-cell *matHeaderCellDef> Rank </th>
            <td mat-cell *matCellDef="let element; let i = index" class="rank-cell">
              <span class="rank-badge rank-badge-least">{{ i + 1 }}</span>
            </td>
          </ng-container>

          <ng-container matColumnDef="stationName">
            <th mat-header-cell *matHeaderCellDef> Station </th>
            <td mat-cell *matCellDef="let element"> {{ element.stationName }} </td>
          </ng-container>

          <ng-container matColumnDef="totalRevenueNGN">
            <th mat-header-cell *matHeaderCellDef class="text-right"> Revenue (₦) </th>
            <td mat-cell *matCellDef="let element" class="revenue-cell revenue-cell-least"> ₦{{ element.totalRevenueNGN
              | number:'1.0-0' }} </td>
          </ng-container>

          <tr mat-header-row *matHeaderRowDef="['rank', 'stationName', 'totalRevenueNGN']" class="ranking-header-row">
          </tr>
          <tr mat-row *matRowDef="let row; columns: ['rank', 'stationName', 'totalRevenueNGN'];"
            class="ranking-row ranking-row-least"></tr>
        </table>
      </mat-card-content>
    </mat-card>
  </div>
</div>