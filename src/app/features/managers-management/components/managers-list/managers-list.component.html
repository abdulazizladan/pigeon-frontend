<h1>Managers</h1>
<div class="users-list-container">

  <!-- Summary Cards -->
  <div class="stats-grid">
    <!-- Total Managers -->
    <div class="stat-card">
      <div class="stat-icon total">
        <mat-icon>group</mat-icon>
      </div>
      <div class="stat-content">
        <div class="stat-label">Total Managers</div>
        <div class="stat-value">{{ totalManagers() }}</div>
        <div class="stat-subtitle">All registered managers</div>
      </div>
    </div>

    <!-- Active Managers -->
    <div class="stat-card">
      <div class="stat-icon active">
        <mat-icon>check_circle</mat-icon>
      </div>
      <div class="stat-content">
        <div class="stat-label">Active Managers</div>
        <div class="stat-value-group">
          <div class="stat-value">{{ activeManagers() }}</div>
          <div class="stat-percentage">{{ activePercentage() }}%</div>
        </div>
        <div class="stat-subtitle">Currently active accounts</div>
      </div>
    </div>

    <!-- Unassigned Managers -->
    <div class="stat-card">
      <div class="stat-icon unassigned">
        <mat-icon>assignment_late</mat-icon>
      </div>
      <div class="stat-content">
        <div class="stat-label">Unassigned Managers</div>
        <div class="stat-value-group">
          <div class="stat-value">{{ unassignedManagers() }}</div>
          <div class="stat-percentage">{{ unassignedPercentage() }}%</div>
        </div>
        <div class="stat-subtitle">No station assigned</div>
      </div>
    </div>

    <!-- Inactive Managers -->
    <div class="stat-card">
      <div class="stat-icon inactive">
        <mat-icon>person_off</mat-icon>
      </div>
      <div class="stat-content">
        <div class="stat-label">Inactive Managers</div>
        <div class="stat-value-group">
          <div class="stat-value">{{ inactiveManagers() }}</div>
          <div class="stat-percentage">{{ inactivePercentage() }}%</div>
        </div>
        <div class="stat-subtitle">Suspended or inactive</div>
      </div>
    </div>
  </div>

  <div class="header" fxLayout="row">
    <mat-form-field appearance="outline" class="search-field">
      <mat-label>Search Managers</mat-label>
      <input matInput (keyup)="applyFilter($event)" placeholder="" #input>
      <mat-icon matPrefix>search</mat-icon>
    </mat-form-field>

    <span fxFlex="1 1 auto"></span>
    <button mat-flat-button color="primary" (click)="openAddManagerDialog()">
      <mat-icon>add</mat-icon>
      Add Manager
    </button>
  </div>

  @if(managersStore.loading()){
  <mat-progress-bar mode="query"></mat-progress-bar>
  }

  @if(managersStore.error()) {
  <mat-error>Could not load managers. Please check your connection and try again.</mat-error>
  }

  <!-- ["name", "email", "station", "status"] -->
  <table mat-table [dataSource]="dataSource" matSort>

    <ng-container matColumnDef="name">
      <th mat-header-cell *matHeaderCellDef>Name</th>
      <td mat-cell *matCellDef="let manager" [routerLink]="[manager.id]" class="clickable-row">{{manager.info.firstName
        | titlecase}} {{manager.info.lastName | titlecase}}</td>
    </ng-container>

    <ng-container matColumnDef="email">
      <th mat-header-cell *matHeaderCellDef>Email</th>
      <td mat-cell *matCellDef="let manager">{{manager.email}}</td>
    </ng-container>

    <ng-container matColumnDef="station">
      <th mat-header-cell *matHeaderCellDef>Station</th>
      <td mat-cell *matCellDef="let manager">
        <span [class.status-chip]="!manager.station" [class.inactive]="!manager.station">
          {{ manager.station?.name || 'unassigned' }}
        </span>
      </td>
    </ng-container>

    <ng-container matColumnDef="status">
      <th mat-header-cell *matHeaderCellDef>Status</th>
      <td mat-cell *matCellDef="let manager">
        <span class="status-chip" [class.active]="manager.status === 'active'"
          [class.inactive]="manager.status !== 'active'">
          {{manager.status}}
        </span>
      </td>
    </ng-container>

    <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
    <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>

    <tr class="mat-row" *matNoDataRow>
      <td class="mat-cell" colspan="4">
        No managers added.
      </td>
    </tr>

  </table>
  <mat-paginator [length]="dataSource.filteredData.length || 0" [pageSize]="10" [pageSizeOptions]="[5, 10, 20]"
    [showFirstLastButtons]="true" aria-label="Select page">
  </mat-paginator>