<div class="page-container">

  <!-- Header Section -->
  <div class="page-header">
    <div class="header-content">
      <div class="title-group">
        <h1>Sales Dashboard</h1>
        <p>Monitor revenue trends and station performance</p>
      </div>

      <div class="action-group">
        <button mat-stroked-button color="primary" (click)="exportData()" [disabled]="loading()">
          <mat-icon>cloud_download</mat-icon>
          Export Data
        </button>
        <button mat-flat-button color="primary" (click)="openSalesDialog()">
          <mat-icon>add</mat-icon>
          Add Sale
        </button>
      </div>
    </div>
  </div>

  <!-- Loading State -->
  @if (loading()) {
  <div class="loading-state">
    <mat-progress-bar mode="indeterminate"></mat-progress-bar>
    <p>Loading dashboard data...</p>
  </div>
  }

  <!-- Error State -->
  @if (error()) {
  <div class="card-base error-card">
    <mat-icon>error_outline</mat-icon>
    <div class="error-content">
      <h3>Error Loading Data</h3>
      <p>{{ error() }}</p>
    </div>
    <button mat-flat-button color="warn" (click)="loadDashboardData()">Retry</button>
  </div>
  }

  <!-- Dashboard Content -->
  @if (!loading() && !error()) {
  <div class="dashboard-grid">

    <!-- Filters and Summary Row -->
    <div class="controls-section">

      <!-- Filter Card -->
      <div class="card-base filter-panel">
        <div class="filter-group">
          <mat-form-field appearance="outline" class="filter-field">
            <mat-label>Filter by Station</mat-label>
            <mat-select [formControl]="filterForm.controls.stationId">
              <mat-option value="all">All Stations</mat-option>
              @for (station of allStations(); track station.id) {
              <mat-option [value]="station.id">{{ station.name }}</mat-option>
              }
            </mat-select>
            <mat-icon matPrefix>business</mat-icon>
          </mat-form-field>

          <mat-form-field appearance="outline" class="filter-field">
            <mat-label>Time Period</mat-label>
            <mat-select [formControl]="filterForm.controls.timePeriod">
              <mat-option value="weekly">Weekly</mat-option>
              <mat-option value="monthly">Monthly</mat-option>
            </mat-select>
            <mat-icon matPrefix>calendar_today</mat-icon>
          </mat-form-field>
        </div>
      </div>

      <!-- Total Revenue Summary Card -->
      <div class="card-base summary-card">
        <div class="icon-wrapper">
          <mat-icon>payments</mat-icon>
        </div>
        <div class="summary-details">
          <span class="label">Total Sales Revenue</span>
          <span class="value">{{ formatCurrency(totalSales()) }}</span>
          <span class="subtitle">Across all stations and periods</span>
        </div>
      </div>
    </div>

    <!-- Charts Grid -->
    <div class="charts-layout">
      <!-- Sales Trend Chart -->
      <div class="card-base chart-card">
        <div class="card-header">
          <div class="title-with-icon">
            <!--<mat-icon class="trend-icon">trending_up</mat-icon>-->
            <h3>{{ currentTimePeriod() === 'weekly' ? 'Weekly' : 'Monthly' }} Sales Trend</h3>
          </div>
        </div>
        <div class="card-body">
          <canvas baseChart [data]="salesTrendChartData()" [options]="lineChartOptions" [type]="lineChartType">
          </canvas>
        </div>
      </div>

      <!-- Station Comparison Chart -->
      <div class="card-base chart-card">
        <div class="card-header">
          <div class="title-with-icon">
            <!--<mat-icon class="bar-icon">bar_chart</mat-icon>-->
            <h3>Station Performance</h3>
          </div>
        </div>
        <div class="card-body">
          <canvas baseChart [data]="stationComparisonChartData()" [options]="barChartOptions" [type]="barChartType">
          </canvas>
        </div>
      </div>
    </div>

  </div>
  }
</div>