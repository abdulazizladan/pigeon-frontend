<div class="user-management-container">
  <mat-card class="user-card">
    <mat-card-header>
      <mat-card-title>User List</mat-card-title>
      <mat-card-subtitle>Manage your application users</mat-card-subtitle>
    </mat-card-header>
    <mat-card-content>
      <div fxLayout="row" fxLayoutGap="25px">
        <mat-form-field appearance="outline" fxFlex="1 1 auto">
          <mat-label>Search users</mat-label>
          <input matInput [formControl]="searchControl" placeholder="e.g., John Doe, admin@example.com">
          <mat-icon matSuffix>search</mat-icon>
        </mat-form-field>

        <button mat-flat-button color="primary" (click)="openAddUserDialog()">
          <mat-icon>person_add</mat-icon>
          Add User
        </button>
      </div>

      @if(userStore.loading()){
          <mat-progress-bar mode="query"></mat-progress-bar>
      }
      <div class="mat-elevation-z2 table-responsive">
        <table mat-table [dataSource]="filteredUsers()" class="full-width-table">

          <ng-container matColumnDef="name">
            <th mat-header-cell *matHeaderCellDef> Name </th>
            <td mat-cell *matCellDef="let user"> {{user.info?.firstName}} {{user.info?.lastName}} </td>
          </ng-container>

          <ng-container matColumnDef="email">
            <th mat-header-cell *matHeaderCellDef> Email </th>
            <td mat-cell *matCellDef="let user"> {{user.email}} </td>
          </ng-container>

          <ng-container matColumnDef="role">

            <th mat-header-cell *matHeaderCellDef> Role </th>
            
            <td mat-cell *matCellDef="let user">
            
            <mat-chip-listbox>
            
            <mat-chip [color]="getRoleColor(user.role)" selected>
            
            {{user.role | titlecase}}
            
            </mat-chip>
            
            </mat-chip-listbox>
            
            </td>
            
            </ng-container>
            
            
            
            <ng-container matColumnDef="status">
            
            <th mat-header-cell *matHeaderCellDef> Status </th>
            
            <td mat-cell *matCellDef="let user">
            
            <span [ngClass]="{'status-active': user.status === 'active', 'status-inactive': user.status === 'inactive'}">
            
            {{ user.status | titlecase }}
            
            </span>
            
            </td>
            
            </ng-container>

          <!--<ng-container matColumnDef="actions">
            <th mat-header-cell *matHeaderCellDef> Actions </th>
            <td mat-cell *matCellDef="let user" (click)="$event.stopPropagation()">
              <button mat-icon-button [matMenuTriggerFor]="userActionsMenu" aria-label="User actions">
                <mat-icon>more_vert</mat-icon>
              </button>
              <mat-menu #userActionsMenu="matMenu">
                  <button mat-menu-item [routerLink]="['/users', user.email]">
                      <mat-icon>visibility</mat-icon>
                      <span>View details</span>
                    </button>
                  <button mat-menu-item (click)="openRemoveUserDialog(user.id)">
                  <mat-icon>block</mat-icon>
                  <span>Suspend</span>
                </button>
              </mat-menu>
            </td>
          </ng-container>-->

          <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>

          <tr mat-row
              *matRowDef="let row; columns: displayedColumns;"
              [routerLink]="[row.email]"
              class="clickable-row">
          </tr>

          <tr class="mat-row" *matNoDataRow>
            <td class="mat-cell" [attr.colspan]="displayedColumns.length">No users matching "{{searchTerm()}}"</td>
          </tr>
        </table>
      </div>
    </mat-card-content>
  </mat-card>
</div>