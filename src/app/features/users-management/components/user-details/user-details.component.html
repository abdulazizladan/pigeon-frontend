<div class="p-6 bg-gray-50 min-h-screen font-sans">
  <div class="max-w-4xl mx-auto">
    
    <h1 class="text-3xl font-extrabold mb-6 text-gray-800">User Details</h1>
    
    <div class="bg-white shadow-2xl rounded-xl p-6 md:p-8 border border-gray-100 transition duration-300">
      
      <!-- Loading and Error Indicators -->
      @if(userStore.loading()) {
        <mat-progress-bar mode="query" class="w-full h-2 mb-4 rounded-full"></mat-progress-bar>
      }

      @if(userStore.error()) {
        <mat-error class="p-3 bg-red-50 text-red-700 rounded-lg mb-4 block border border-red-200">
          <mat-icon class="text-lg mr-2 align-middle">error_outline</mat-icon>
          {{userStore.error()}}
        </mat-error>
      }
      
      <div class="flex flex-col sm:flex-row gap-6 mb-8">
        <!-- Profile Image/Avatar Section -->
        <div class="flex-shrink-0 flex justify-center">
          <div class="w-24 h-24 sm:w-32 sm:h-32 rounded-full bg-gray-300 flex items-center justify-center text-4xl text-gray-500 shadow-md overflow-hidden">
            <mat-icon>person</mat-icon>
          </div>
        </div>

        <!-- User Info List -->
        <div class="flex-grow">
          <h2 class="text-2xl font-semibold mb-4 text-gray-900">{{userStore.selectedUser()?.info?.firstName}} {{userStore.selectedUser()?.info?.lastName}}</h2>
          
          <mat-list role="list" class="user-details-list">
            <!-- Account Status -->
            <mat-list-item role="listitem" class="text-gray-700">
              <mat-icon matListItemIcon class="text-indigo-500">verified_user</mat-icon>
              <div class="flex items-center space-x-2">
                <span class="font-medium">Account Status:</span>
                <!-- Status Pills using Tailwind -->
                @switch (userStore.selectedUser()?.status) {
                  @case ('active') {
                    <span class="bg-green-100 text-green-700 px-3 py-1 text-xs font-semibold rounded-full min-w-[75px] text-center">Active</span>
                  }
                  @case ('inactive') {
                    <span class="bg-red-100 text-red-700 px-3 py-1 text-xs font-semibold rounded-full min-w-[75px] text-center">Inactive</span>
                  }
                  @case ('suspended') {
                    <span class="bg-orange-100 text-orange-700 px-3 py-1 text-xs font-semibold rounded-full min-w-[75px] text-center">Suspended</span>
                  }
                  @default {
                    <span class="bg-gray-100 text-gray-700 px-3 py-1 text-xs font-semibold rounded-full min-w-[75px] text-center">Unknown</span>
                  }
                }
              </div>
            </mat-list-item>
            
            <!-- Account Created -->
            <mat-list-item role="listitem" class="text-gray-700">
              <mat-icon matListItemIcon class="text-blue-500">access_time</mat-icon>
              <span class="font-medium">Account Created:</span> {{userStore.selectedUser()?.createdAt | date: 'medium'}}
            </mat-list-item>

            <!-- Role -->
            <mat-list-item role="listitem" class="text-gray-700">
              <mat-icon matListItemIcon class="text-purple-500">account_circle</mat-icon>
              <span class="font-medium">Role:</span> {{userStore.selectedUser()?.role | titlecase}}
            </mat-list-item>
            
            <!-- Email -->
            <mat-list-item role="listitem" class="text-gray-700">
              <mat-icon matListItemIcon class="text-pink-500">email</mat-icon>
              <span class="font-medium">Email:</span> {{userStore.selectedUser()?.email}}
            </mat-list-item>
            
            <!-- Phone -->
            <mat-list-item role="listitem" class="text-gray-700">
              <mat-icon matListItemIcon class="text-green-500">phone</mat-icon>
              <span class="font-medium">Phone:</span> +234{{userStore.selectedUser()?.contact?.phone}}
            </mat-list-item>

            <!-- Reports (Conditional) -->
            @if(userStore.selectedUser()?.role === 'manager') {
              <mat-list-item role="listitem" class="text-gray-700">
                <mat-icon matListItemIcon class="text-orange-500">assignment</mat-icon>
                <span class="font-medium">Reports:</span> {{userStore.selectedUser()?.reports?.length}}
              </mat-list-item>
            }
            
            <!-- Support Tickets Count -->
            <mat-list-item role="listitem" class="text-gray-700">
              <mat-icon matListItemIcon class="text-red-500">support_agent</mat-icon>
              <span class="font-medium">Support Tickets:</span> {{userStore.selectedUser()?.tickets?.length}}
            </mat-list-item>
          </mat-list>
        </div>
      </div>

     <!-- Suspend / Enable Button Section (Dynamically rendered) -->
     <div class="flex justify-end pt-4 border-t border-gray-100">
      @if(userStore.selectedUser()?.id) {
        @if(userStore.selectedUser()?.status === 'active') {
          <!-- SUSPEND Button (If active) -->
          <button mat-flat-button color="warn" (click)="openSuspendUserDialog(userStore.selectedUser()?.email)">
            <mat-icon>block</mat-icon>
            Suspend User Account
          </button>
        } @else {
          <!-- ENABLE Button (If inactive or suspended) -->
          <button mat-flat-button color="primary" (click)="openEnableUserDialog(userStore.selectedUser()?.email)">
            <mat-icon>check_circle_outline</mat-icon>
            Enable User Account
          </button>
        }
      }
    </div>

      <!-- Support Tickets List -->
      <h2 class="text-2xl font-semibold mt-8 mb-4 border-t pt-4 text-gray-800">Support Tickets</h2>
      
      @if(userStore.selectedUser()?.tickets?.length) {
        @for(ticket of userStore.selectedUser()?.tickets; track ticket.id) {
          <div class="ticket-card bg-gray-50 p-4 rounded-lg shadow-sm mb-3 border border-gray-200 hover:bg-gray-100 transition duration-150">
            <h3 class="text-lg font-semibold text-gray-900 mb-1">{{ticket.title}}</h3>
            <p class="text-sm text-gray-600 mb-2 truncate">{{ticket.description}}</p>
            <div class="flex justify-between items-center text-xs text-gray-500">
              <p>
                Status: 
                @switch (ticket.status) {
                  @case ('active') {
                    <span class="font-medium text-blue-600">{{ticket.status | titlecase}}</span>
                  }
                  @case ('resolved') {
                    <span class="font-medium text-green-600">{{ticket.status | titlecase}}</span>
                  }
                  @default {
                    <span class="font-medium text-gray-600">{{ticket.status | titlecase}}</span>
                  }
                }
              </p>
              <p>Date Created: {{ticket.dateCreated | date:'short'}}</p>
            </div>
            <div class="mt-3">
               <!-- Replaced routerLink with a mock action for demonstration -->
              <!--<button mat-flat-button color="primary" (click)="viewTicketDetails(ticket.id)">
                View Ticket Details
              </button>-->
            </div>
          </div>
        }
      } @else {
       <h3 class="text-lg text-gray-500 italic p-4 bg-gray-100 rounded-lg">No support tickets found for this user.</h3>
      }

    </div>
  </div>
</div>