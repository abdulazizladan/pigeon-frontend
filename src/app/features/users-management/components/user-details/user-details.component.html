<div class="user-details-page-wrapper">
  <div class="user-details-container">
    <h1 class="page-title">User Details</h1>

    <mat-card class="user-profile-card">
      @if(userStore.loading()) {
        <mat-progress-bar mode="query"></mat-progress-bar>
      }

      @if(userStore.error()) {
        <mat-error class="error-banner">
          <mat-icon class="error-icon">error_outline</mat-icon>
          {{userStore.error()}}
        </mat-error>
      }

      <div class="profile-header-section">
        <div class="profile-avatar-wrapper">
          <div class="profile-avatar">
            <mat-icon>person</mat-icon>
          </div>
        </div>

        <div class="profile-summary">
          <h2 class="user-full-name">
            {{userStore.selectedUser()?.info?.firstName}} {{userStore.selectedUser()?.info?.lastName}}
          </h2>
          
          <div class="status-indicator">
            <span class="status-label">Account Status:</span>
            @switch (userStore.selectedUser()?.status) {
              @case ('active') {
                <span class="status-pill status-active">Active</span>
              }
              @case ('inactive') {
                <span class="status-pill status-inactive">Inactive</span>
              }
              @case ('suspended') {
                <span class="status-pill status-suspended">Suspended</span>
              }
              @default {
                <span class="status-pill status-unknown">Unknown</span>
              }
            }
          </div>
        </div>
      </div>

      <div class="details-grid">
        <div class="detail-item">
          <mat-icon color="primary">account_circle</mat-icon>
          <div class="detail-content">
            <span class="detail-label">Role:</span>
            <span class="detail-value">{{userStore.selectedUser()?.role | titlecase}}</span>
          </div>
        </div>
        
        <div class="detail-item">
          <mat-icon>email</mat-icon>
          <div class="detail-content">
            <span class="detail-label">Email:</span>
            <span class="detail-value">{{userStore.selectedUser()?.email}}</span>
          </div>
        </div>
        
        <div class="detail-item">
          <mat-icon>phone</mat-icon>
          <div class="detail-content">
            <span class="detail-label">Phone:</span>
            <span class="detail-value">+234{{userStore.selectedUser()?.contact?.phone}}</span>
          </div>
        </div>

        <div class="detail-item">
          <mat-icon>access_time</mat-icon>
          <div class="detail-content">
            <span class="detail-label">Account Created:</span>
            <span class="detail-value">{{userStore.selectedUser()?.createdAt | date: 'medium'}}</span>
          </div>
        </div>

        @if(userStore.selectedUser()?.role === 'manager') {
          <div class="detail-item">
            <mat-icon color="accent">assignment</mat-icon>
            <div class="detail-content">
              <span class="detail-label">Reports:</span>
              <span class="detail-value">{{userStore.selectedUser()?.reports?.length}}</span>
            </div>
          </div>
        }
        
        <div class="detail-item">
          <mat-icon color="warn">support_agent</mat-icon>
          <div class="detail-content">
            <span class="detail-label">Support Tickets:</span>
            <span class="detail-value">{{userStore.selectedUser()?.tickets?.length}}</span>
          </div>
        </div>
      </div>
      
      <div class="action-buttons-footer">
        @if(userStore.selectedUser()?.id && userStore.selectedUser()?.role != 'admin') {
          @if(userStore.selectedUser()?.status === 'active') {
            <button mat-flat-button color="warn" (click)="openSuspendUserDialog(userStore.selectedUser()?.email)">
              <mat-icon>block</mat-icon>
              Suspend User Account
            </button>
          } @else {
            <button mat-flat-button color="primary" (click)="openEnableUserDialog(userStore.selectedUser()?.email)">
              <mat-icon>check_circle_outline</mat-icon>
              Enable User Account
            </button>
          }
        }
      </div>
    </mat-card>

    <mat-card class="tickets-section-card">
      <h2 class="section-title">Support Tickets</h2>
      
      @if(userStore.selectedUser()?.tickets?.length) {
        <div class="tickets-list">
          @for(ticket of userStore.selectedUser()?.tickets; track ticket.id) {
            <div class="ticket-card">
              <div class="ticket-header">
                <h3 class="ticket-title">{{ticket.title}}</h3>
                <div class="ticket-status">
                   Status: 
                  @switch (ticket.status) {
                    @case ('active') {
                      <span class="status-value status-active">{{ticket.status | titlecase}}</span>
                    }
                    @case ('resolved') {
                      <span class="status-value status-resolved">{{ticket.status | titlecase}}</span>
                    }
                    @default {
                      <span class="status-value status-default">{{ticket.status | titlecase}}</span>
                    }
                  }
                </div>
              </div>
              <p class="ticket-description">{{ticket.description}}</p>
              <div class="ticket-footer">
                <p class="ticket-date">Date Created: {{ticket.dateCreated | date:'short'}}</p>
                </div>
            </div>
          }
        </div>
      } @else {
       <div class="no-tickets-message">No support tickets found for this user.</div>
      }
    </mat-card>
  </div>
</div>